{% extends 'base.html' %}

{% block title %}Queue Status{% endblock %}

{% block content %}
    <div class="queue-status">
        <h1>Your Queue Status</h1>
        
        <div class="queue-id-display" onclick="copyQueueId('{{ queue_id }}')">
            <span class="queue-id-label">Your Queue ID</span>
            <span class="queue-id-value">{{ queue_id }}</span>
            <span class="copy-hint">Click to copy</span>
            <div class="copy-success" id="copySuccess">Copied!</div>
        </div>
        
        <div class="queue-number">
            Position: {{ status.position }}
        </div>
        
        <div class="queue-info">
            <p>People ahead of you: {{ status.position - 1 }}</p>
            <p>Total in queue: {{ status.total_in_queue }}</p>
            <p>Estimated wait time: {{ status.estimated_wait }} minutes</p>
            <p>Joined at: {{ status.joined_at }}</p>
        </div>
        
        <div class="queue-actions">
            <form method="POST" action="{{ url_for('leave_queue', location_id=location_id, queue_id=queue_id) }}">
                <button type="submit" class="button button-danger">Leave Queue</button>
            </form>
        </div>
        
        <div class="queue-refresh">
            <small>This page will refresh automatically every 30 seconds</small>
        </div>
    </div>

    <script>
        function copyQueueId(queueId) {
            navigator.clipboard.writeText(queueId).then(function() {
                const successElement = document.getElementById('copySuccess');
                successElement.classList.add('show');
                setTimeout(function() {
                    successElement.classList.remove('show');
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = queueId;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const successElement = document.getElementById('copySuccess');
                successElement.classList.add('show');
                setTimeout(function() {
                    successElement.classList.remove('show');
                }, 2000);
            });
        }

        setTimeout(function() {
            window.location.reload();
        }, 30000);
    </script>
{% endblock %}
